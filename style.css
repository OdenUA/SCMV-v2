body { font-family: sans-serif; margin: 20px; }
.controls { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; }
.control-group { display: flex; flex-direction: column; }
label { margin-bottom: 5px; font-size: 14px; }
input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
button:hover { background-color: #0056b3; }
#status { margin-bottom: 20px; font-weight: bold; }
#mapContainer { 
    position: relative; 
    height: 600px; /* Set initial height on the container */
    margin-bottom: 20px;
    margin-left:40px;
    margin-right:40px;
}
#map { 
    height: 100%; /* Map fills the container */
}

/* Allow clicks to underlying map through manual route markers */
.manual-route-point { pointer-events: none; }
#resizeHandle {
    position: absolute;
    bottom: -5px; /* Position it on the border */
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 10px;
    background-color: #ccc;
    border: 1px solid #aaa;
    border-radius: 5px;
    cursor: ns-resize;
    z-index: 401; /* Ensure it's above map panes */
}
table { 
    width: 100%; 
    border-collapse: collapse; 
    font-size: 0.8rem;
}
th, td { 
    border: 1px solid #ddd; 
    padding: 4px; /* Уменьшаем отступы */
    text-align: left; 
}
th { 
    background-color: #f2f2f2; 
    position: sticky;
    top: 0;
    z-index: 1;
}
tr:nth-child(even) { background-color: #f9f9f9; }
.parking-marker {
    background-color: rgba(220, 20, 60, 0.85); /* Crimson with opacity */
    color: white;
    border-radius: 50%;
    text-align: center;
    font-size: 14px;
    font-weight: bold;
    line-height: 24px; /* Match iconSize height */
    border: 1px solid white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.6);
}
.custom-div-icon .marker-pin {
    width: 30px;
    height: 30px;
    border-radius: 50% 50% 50% 0;
    position: absolute;
    transform: rotate(-45deg);
    left: 50%;
    top: 50%;
    margin: -15px 0 0 -15px;
}
.custom-div-icon .marker-pin::after {
    content: '';
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: white;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
.custom-div-icon span {
    position: absolute;
    top: -2px;
    left: 0;
    width: 100%;
    text-align: center;
}
#additionalResponses {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    margin-top: 20px;
}

.response-container {
    width: 48%;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
}

.response-container h3 {
    margin-top: 0;
}

.response-container pre {
    background-color: #f4f4f4;
    padding: 10px;
    border-radius: 4px;
    white-space: pre-wrap;       /* Since CSS 2.1 */
    word-wrap: break-word;       /* Internet Explorer 5.5+ */
    max-height: 300px;
    overflow-y: auto;
}

.tables-wrapper {
    display: flex;
    gap: 20px;
}

.tables-wrapper .table-container {
    flex: 1;
    min-width: 0;
}

.table-scroll {
    max-height: 250px;
    overflow-y: auto;
    overflow-x: auto;
    flex-grow: 1;
}

.main-content-wrapper {
    display: flex;
    gap: 20px;
    padding: 10px;
}

.left-column {
    flex: 2; /* Занимает 2/3 ширины */
    display: flex;
    flex-direction: column;
}

.right-column {
    flex: 1; /* Занимает 1/3 ширины */
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.table-container {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    background-color: #fff;
    display: flex;
    flex-direction: column;
    min-width: 0;
}

.left-column .table-container,
.right-column .table-container {
    flex: 1;
}

h2 {
    margin-top: 0;
    font-size: 1rem;
}
.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.table-header h2 {
    margin: 0;
}

/* Modal Styles */
.modal {
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: #fefefe;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 60%;
    max-width: 800px;
    border-radius: 8px;
    position: relative;
}

.close-button {
    color: #aaa;
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close-button:hover,
.close-button:focus {
    color: black;
}

#sql-output {
    background-color: #f8f9fa;
    padding: 12px;
    border-radius: 4px;
    font-family: monospace;
    font-size: 12px;
    line-height: 1.4;
    white-space: pre-wrap;
    max-height: 400px;
    overflow-y: auto;
}
.debug-container {
    background-color: #2c2c2c;
    color: #f1f1f1;
    padding: 15px;
    margin-top: 20px;
    border-radius: 5px;
    max-height: 300px;
    overflow-y: auto;
    font-family: 'Courier New', Courier, monospace;
}

.debug-container h3 {
    margin-top: 0;
    color: #ffc107;
}

#boundsDebugOutput {
    white-space: pre-wrap;
    word-wrap: break-word;
}

/* --- Extracted styles from former inline attributes --- */
.login-panel {display:flex;gap:12px;align-items:center;margin-bottom:10px;flex-wrap:wrap;font:14px/1.3 system-ui,sans-serif;}
.login-panel label {display:flex;flex-direction:column;font-size:12px;color:#555;margin:0;}
.login-panel input[type=text],
.login-panel input[type=password]{padding:4px 6px;border:1px solid #ced4da;border-radius:4px;min-width:160px;font:inherit;}

/* Small status dot used in loginInfo */
.status-dot{ width:12px; height:12px; vertical-align:middle; margin-left:8px; }
.status-dot circle{ fill:#dc3545; stroke: rgba(0,0,0,0.06); stroke-width:0.5; }
.status-online circle{ fill:#28a745; }
.status-offline circle{ fill:#dc3545; }
.login-panel .remember-wrap {display:flex;align-items:center;gap:6px;font-size:12px;color:#555;margin-top:18px;}
.btn {background:#0d6efd;color:#fff;border:none;padding:8px 14px;border-radius:4px;cursor:pointer;font-weight:600;font:13px/1 system-ui,sans-serif;transition:background .15s;}
.btn:hover {filter:brightness(.94);}
.btn.deactivated {background:#6c757d;}
.btn:disabled{opacity:.55;cursor:not-allowed;}.btn-secondary{background:#6c757d;}
.btn-success{background:#198754; height: 33px;}
.btn-danger{background:#dc3545;}
.btn-warning{background:#ffc107;color:#000;}
.btn-outline{background:#fff;color:#0d6efd;border:1px solid #0d6efd;}
.btn-xs{padding:4px 8px;font-size:11px;}

/* Floating filter panel */
.floating-panel {position:fixed;top:5px;right:12px;z-index:1000;background:#ffffffee;padding:10px 12px;border:1px solid #d0d7de;border-radius:8px;backdrop-filter:blur(4px);box-shadow:0 4px 14px -2px rgba(0,0,0,.18);width:250px;font:13px/1.3 system-ui,sans-serif;transition:transform .25s;}
.floating-panel {display:flex;flex-direction:column;max-height:80vh;}
.floating-panel.collapsed{transform:translateX(230px);} /* slide out */
.floating-panel .panel-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;}
.floating-panel strong{font-size:13px;}
.floating-panel label{display:flex;flex-direction:column;gap:2px;margin-bottom:6px;font-size:12px;}
.floating-panel input[type=number],
.floating-panel input[type=datetime-local]{padding:4px 6px;border:1px solid #ced4da;border-radius:4px;font:inherit;}
.floating-panel .input-with-btn{display:flex;align-items:stretch;gap:6px;}
.floating-panel .input-with-btn input{flex:1;}
.floating-panel .btn-inline{padding:4px 10px;font-weight:600;}
.floating-panel .actions{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px;}
.floating-panel .actions .btn{flex:1 1 100px;padding:6px 8px;}
.actions-grid > div { display: block; }
.actions-grid > div > .btn { width: 100% !important; box-sizing: border-box !important; flex: none !important; }
.actions-grid #actionBottomRight > #devLogWrapper > .btn { width: auto !important; }
.floating-panel .sub-actions{display:flex;align-items:center;gap:6px;margin-bottom:8px;}
.floating-panel .line-width{display:flex;align-items:center;gap:6px;}
.floating-panel .line-width span{font-size:12px;}
.floating-panel .panel-status{margin-top:auto;font-size:12px;padding-top:6px;border-top:1px solid #e1e5eb;color:#555;}

/* Manual route info */
#manualRouteInfo{margin:8px 0;font:14px/1.4 system-ui,sans-serif;padding:6px 10px;background:#f8f9fa;border:1px solid #ced4da;border-radius:4px;display:none;}

/* Vehicle overlay */
.vehicle-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:10050;}
.vehicle-overlay-content{background:#fff;position:absolute;top:20px;bottom:20px;left:120px;right:120px;max-width:calc(100% - 240px);display:flex;flex-direction:column;border-radius:8px;box-shadow:0 0 12px rgba(0,0,0,.35);} 
.vehicle-overlay-header{padding:10px 14px;border-bottom:1px solid #e1e5eb;display:flex;align-items:center;gap:12px;}
.vehicle-overlay-toolbar{padding:8px 14px;display:flex;align-items:center;gap:12px;border-bottom:1px solid #e1e5eb;background:#f8f9fa;}
.vehicle-overlay-body{flex:1;overflow:auto;padding:10px;}
.vehicle-overlay .vehicle-table{ font-size:0.85rem; }
.vehicle-overlay .vehicle-table td, .vehicle-overlay .vehicle-table th { padding:4px 6px; }
.vehicle-overlay .vehicle-table td.action-cell, .vehicle-overlay .vehicle-table th.action-cell { width:56px !important; max-width:56px !important; text-align:center; }
.vehicle-overlay .vehicle-table td.action-cell button, .vehicle-overlay .vehicle-table th.action-cell button { font-size:11px; padding:4px 6px; }
.vehicle-overlay .vehicle-table td.action-cell, .vehicle-overlay .vehicle-table th.action-cell { transition: width .18s ease; }
.vehicle-overlay .vehicle-table td.action-edit-mode { width:140px !important; max-width:240px !important; }
.vehicle-overlay .vehicle-table td.action-edit-mode .vehicle-edit-btn { display:inline-block; margin-right:6px; }

/* Loading skeleton rows for vehicle table */
.vehicle-overlay .vehicle-table .skeleton-row { background: transparent; }
.vehicle-overlay .vehicle-table .skeleton-cell { padding:8px 6px; }
.vehicle-overlay .vehicle-table .skeleton-line { height:12px; background: linear-gradient(90deg, #eee 25%, #f5f5f5 50%, #eee 75%); background-size: 200% 100%; border-radius:4px; animation: skeleton-anim 1.2s linear infinite; }
@keyframes skeleton-anim { from { background-position: 200% 0; } to { background-position: -200% 0; } }

/* Hover highlight for rows in vehicle overlay tables (Device List, Edit Vehicle, selectMin) */
.vehicle-overlay .vehicle-table tbody tr:not(.skeleton-row):not(.vehicle-filter-row):hover {
    background-color: #e8f4ff; /* light blue */
    transition: background-color .12s ease;
    cursor: pointer;
}
.vehicle-table{width:100%;border-collapse:collapse;font:14px/1.4 system-ui,sans-serif;}
.vehicle-table th,.vehicle-table td{padding:4px 8px;border:1px solid #ddd;font-size:12px;}
.vehicle-filter-row input{width:100%;box-sizing:border-box;padding:2px 4px;border:1px solid #d0d7de;border-radius:3px;background:#ffffff;font-size:12px;}

/* Ensure editable inputs/selects in vehicle table fit their cells */
.vehicle-overlay .vehicle-table td input,
.vehicle-overlay .vehicle-table td select,
.vehicle-overlay .vehicle-table td .notes-input-wrap input {
    max-width: 100%;
    width: 100%;
    box-sizing: border-box;
}
.vehicle-overlay .vehicle-table td .notes-input-wrap { display:flex; gap:6px; align-items:center; }
.vehicle-overlay .vehicle-table td .notes-input-wrap button { flex: 0 0 auto; padding:4px 6px; }

/* Sticky header + filter row in vehicle overlay */
.vehicle-overlay-body { position: relative; }
.vehicle-overlay .vehicle-table thead tr:first-child th { position: sticky; top: 0; z-index: 5; background: #f8f9fa; }
.vehicle-overlay .vehicle-table thead tr.vehicle-filter-row th { position: sticky; top: var(--vehicle-table-filter-top, 34px); z-index: 4; background: #fff; }
.vehicle-overlay .vehicle-table thead tr.vehicle-filter-row input { background: transparent; }

/* Route control */
.rt-control a{width:34px;height:34px;display:flex;align-items:center;justify-content:center;font-size:18px;text-decoration:none;background:#fff;color:#333;border-bottom:1px solid #999;}
.rt-control a:last-child{border-bottom:none;}
.rt-control a:hover{background:#f1f3f5;}
.rt-control .rt-reset{font-size:16px;}
.route-mode-active .rt-control .rt-toggle{background:#198754;color:#fff;}

/* Route toast */
.route-toast{position:fixed;top:20px;right:20px;background:#000;color:#fff;padding:8px 12px;border-radius:4px;z-index:10000;font-size:13px;max-width:280px;opacity:0;animation:toast-in .25s forwards;}
@keyframes toast-in{to{opacity:1;}}

/* Route point marker */
.route-point{background:#28a745;border:2px solid #fff;width:26px;height:26px;line-height:22px;border-radius:50%;text-align:center;color:#fff;font-weight:600;font-size:13px;box-shadow:0 0 4px rgba(0,0,0,.4);}

/* Stop markers */
.stop-marker{display:flex;align-items:center;justify-content:center;font-weight:600;border-radius:50%;}
.stop-marker-short{background:#ffc107;color:#000;width:22px;height:22px;font-size:11px;border:1px solid #b38600;}
.stop-marker-long{background:#0d6efd;color:#fff;width:24px;height:24px;font-size:12px;border:1px solid #084298;}

/* Modal buttons */
#copySqlStatus{font-size:12px;color:#198754;display:none;}

/* Filter panel toggle button */
#filterPanelToggle{background:none;border:none;font-size:14px;cursor:pointer;line-height:1;padding:2px 4px;}

/* Misc extracted */
#currentIdDisplay{margin-bottom:6px;font-size:13px;color:#555;}
/* New utility classes from inline cleanup */
.remember-checkbox{margin:0;}
[data-hidden]{display:none;}
.panel-gap{gap:8px;}
.vehicle-overlay-title{margin:0;font-size:18px;flex:1;}
.vehicle-search-input{flex:1;padding:6px 8px;border:1px solid #ced4da;border-radius:4px;}

/* Limit Device Track Details height */
.track-scroll{max-height:300px;}

/* Two-column layout for Device Alarm & Device Log tables (side by side) */
.device-extra-grid{display:flex;flex-direction:row;flex-wrap:nowrap;gap:12px;margin-top:12px;align-items:stretch;}
.device-extra-grid .table-container{margin-top:0;flex:1;min-width:0;display:flex;flex-direction:column;}

/* Increase vertical space (double typical) and limit widths */
.device-extra-grid .table-scroll{max-height:500px;} /* было условно ~250 -> теперь ~x2 */

/* Device Alarm fixed width 800px */
.device-extra-grid .table-container:first-child{flex:0 0 800px;max-width:800px;}
/* Device Log keeps max 500px, can shrink if мало места */
.device-extra-grid .table-container:last-child{flex:1 1 500px;max-width:500px;}

/* Start/Stop Sum Result height limit */
.sum-scroll{max-height:300px;overflow:auto;}

/* Device Alarm highlighting classes (used by device_log.js) */
.dalarm-danger { background: #f8d7da !important; color: #721c24 !important; }
.dalarm-warning { background: #fff3cd !important; color: #856404 !important; }
.dalarm-success { background: #d4edda !important; color: #155724 !important; }
.dalarm-duration { font-size: 0.9em; opacity: 0.85; display: inline-block; margin-top:4px; }
.sum-scroll table{width:100%;}

/* Vehicle color filter buttons */
.color-filter-group{display:flex;align-items:center;gap:6px;margin-left:10px;flex-wrap:wrap;font-size:12px;}
.color-filter-label{font-weight:600;}
.color-filter-btn{width:26px;height:22px;padding:0;border:1px solid #555;border-radius:4px;cursor:pointer;box-shadow:0 0 0 1px rgba(0, 0, 0, 0.096);color:#474747}
.color-filter-btn.active{outline:2px solid #000;outline-offset:1px;}
.color-filter-btn:focus-visible{outline:2px solid #ffffff;outline-offset:1px;}
.cf-color-facacaff{background:#facacaff;}
.cf-color-fce3d3ff{background:#fce3d3ff;}
.cf-color-ffecc7ff{background:#ffecc7ff;}
.cf-color-fff7ecff{background:#fff7ecff;}
.cf-color-ffffffff{background:#ffffffff;}

/* Leaflet control/attribution shift so it doesn't overlap side panel */
.leaflet-bottom.leaflet-right .leaflet-control-attribution,
.leaflet-bottom.leaflet-right .leaflet-control-scale,
.leaflet-bottom.leaflet-right .leaflet-bar{
    margin-right:270px; /* roughly panel width + spacing */
}

@media (max-width: 1100px){
    .leaflet-bottom.leaflet-right .leaflet-control-attribution,
    .leaflet-bottom.leaflet-right .leaflet-control-scale,
    .leaflet-bottom.leaflet-right .leaflet-bar{ margin-right:10px; }
}

/* Full Device Track interval highlighting */
.fdt-interval-type1 { background: #fff4d6 !important; }
.fdt-interval-type2 { background: #e0f3ff !important; }

/* Popup 'Показать в Full' icon button */
.ft-show-btn{ background:transparent;border:none;color:var(--ft-btn-color,#0d6efd);padding:2px 4px;margin:4px 0;cursor:pointer;display:inline-flex;align-items:center;gap:6px; }
.ft-show-btn:focus{ outline:2px solid rgba(13,110,253,0.2); }
.ft-show-btn .ft-icon{ width:16px;height:16px;display:block;fill:currentColor; }
.ft-show-btn svg.ft-icon path{ fill:currentColor; }
.fdt-interval-type3 { background: #fde2f3 !important; }
.fdt-interval-type4 { background: #ffdfe6 !important; } /* GPS anomaly intervals */
.fdt-interval-marker { box-shadow: inset 0 0 0 2px #444; }
.fdt-focused-row { outline:2px solid #000 !important; outline-offset:-2px; }
#fullDeviceTrackTable.loading tbody::before,
#deviceAlarmTable.loading tbody::before,
#deviceLogTable.loading tbody::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    /* centering is handled in the overlay animation to avoid interfering
       with the rotation transform and causing positional jitter */
    width: 34px;
    height: 34px;
    border: 4px solid #d0d7de;
    border-top-color: #0d6efd;
    border-radius: 50%;
    animation: dt-spin-overlay .8s linear infinite;
    transform-origin: center center;
    box-sizing: border-box;
    background: rgba(255,255,255,0.6);
    box-shadow: 0 0 4px rgba(0,0,0,0.15);
    z-index: 10;
    pointer-events: none;
}
/* Ensure table containers allow absolute overlay */
.table-scroll { position: relative; }
/* Spinner variant */
.dt-spinner { width:18px; height:18px; border:3px solid #d0d7de; border-top-color:#0d6efd; border-radius:50%; animation: dt-spin 0.8s linear infinite; display:inline-block; vertical-align:middle; transform-origin:center center; box-sizing:border-box; will-change:transform; line-height:0; backface-visibility:hidden; }
@keyframes dt-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes dt-spin-overlay { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
/* Hover feedback for report rows */
#fullDeviceTrackReportTable tbody tr{cursor:pointer;}
#fullDeviceTrackReportTable tbody tr:hover{background:#dbeafe !important;}

/* Highlighted row in Full Device Track table when focused from map popup */
#fullDeviceTrackTbody tr.highlighted { background: #fff1b8 !important; outline: 2px solid #ffc107; }
#fullDeviceTrackTbody tr { cursor: pointer; }
#fullDeviceTrackTbody tr:hover { background: #dbeafe !important; }

/* Removed original .custom-layers-control rules (we no longer use
   the default Leaflet layers control in favour of an independent
   Tracks/Parking control.) */

/* Small inline toggle buttons placed inside the layers control */
.layers-toggle-wrap {
    display:flex;
    flex-direction: column; /* stack vertically */
    gap:6px;
    padding:4px;
    justify-content:flex-start;
    align-items:center;
    /* remove any default leaflet bar border/background so no frame appears */
    border: none !important;
    background: transparent !important;
    box-shadow: none !important;
}

/* Route mode: show crosshair on map container, but preserve pointer cursor on interactive features */
.route-mode-active #map,
.route-mode-active #map .leaflet-marker-icon,
.route-mode-active #map .leaflet-interactive,
.route-mode-active #map .leaflet-popup-content,
.route-mode-active #map .leaflet-control {
    /* Keep crosshair everywhere on the map during route mode so cursor doesn't jump to pointer */
    cursor: crosshair !important;
}
.layers-toggle-btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:34px;
    height:34px;
    border-radius:0;
    background-color: #ffffff; /* solid white background */
    border: 1px solid #ddd; /* thin border */
    cursor:pointer;
    text-decoration:none;
    color:#333;
    box-shadow: 0 1px 2px rgba(0,0,0,0.06);
}
.layers-toggle-btn:hover{ background-color:#f1f5ff; box-shadow: 0 2px 8px rgba(51,136,255,0.12); transform: translateY(-1px); }
.layers-toggle-btn.active{ background-color:#3399ff; border: 2px solid #0066cc; color: white; }

/* Floating action button to toggle the filter panel (matches floating-panel look) */
.panel-fab{
    position:fixed;
    top:12px;
    right:12px;
    z-index:10010;
    width:40px;
    height:40px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:8px;
    background:#3399ff;
    border:1px solid #0066cc;
    color: white;
    box-shadow:0 6px 18px -6px rgba(0,0,0,.35);
    cursor:pointer;
    font-size:16px;
    transition:transform .18s, opacity .18s;
}
.panel-fab:hover{ transform:translateY(-3px); }
.panel-fab[aria-pressed="false"]{ opacity:0.9; }

/* When panel is collapsed we move the FAB to sit near the edge and rotate its arrow */
.floating-panel.collapsed + .panel-fab{ right:12px; transform: translateX(0); }
.floating-panel.collapsed { --panel-collapsed: 1; }
.floating-panel.collapsed ~ .panel-fab { transform: translateX(0) rotate(180deg); }
